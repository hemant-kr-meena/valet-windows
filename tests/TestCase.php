<?php

namespace Tests;

use Closure;
use Illuminate\Container\Container;
use Mockery;
use PHPUnit\Framework\TestCase as BaseTestCase;

abstract class TestCase extends BaseTestCase
{
	/**
	 * @return void
	 */
	public function tearDown(): void
	{
		Mockery::close();
		Container::setInstance(null);
	}

	/**
	 * Register an instance of an object in the container.
	 *
	 * @param  string  $abstract
	 * @param  object  $instance
	 * @return object
	 */
	protected function instance($abstract, $instance)
	{
		Container::getInstance()->instance($abstract, $instance);

		return $instance;
	}

	/**
	 * Mock an instance of an object in the container.
	 *
	 * @param  string  $abstract
	 * @param  \Closure|null  $mock
	 * @return \Mockery\MockInterface
	 */
	protected function mock($abstract, Closure $mock = null)
	{
		return $this->instance($abstract, Mockery::mock(...array_filter(func_get_args())));
	}

	/**
	 * Mock a partial instance of an object in the container.
	 *
	 * @param  string  $abstract
	 * @param  \Closure|null  $mock
	 * @return \Mockery\MockInterface
	 */
	protected function partialMock($abstract, Closure $mock = null)
	{
		return $this->instance($abstract, Mockery::mock(...array_filter(func_get_args()))->makePartial());
	}

	/**
	 * Spy an instance of an object in the container.
	 *
	 * @param  string  $abstract
	 * @param  \Closure|null  $mock
	 * @return \Mockery\MockInterface
	 */
	protected function spy($abstract, Closure $mock = null)
	{
		return $this->instance($abstract, Mockery::spy(...array_filter(func_get_args())));
	}
}
